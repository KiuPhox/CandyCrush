(()=>{"use strict";var e,t={992:(e,t,s)=>{var i,a=s(260);class n extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}!function(e){e.BLUE="blue",e.GREEN="green",e.ORANGE="orange",e.PURPLE="purple",e.RED="red",e.YELLOW="yellow"}(i||(i={}));const d={blue:430079,green:1507072,orange:16736256,purple:14506198,red:16646144,yellow:16776960},r={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:64,candyTypes:[i.BLUE,i.GREEN,i.ORANGE,i.PURPLE,i.RED,i.YELLOW]};class h{static Float(e,t){return Math.random()*(t-e)+e}static Int(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static Percent(e){return this.Float(0,100)<=e}}class o extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.candyType=e.candyType,this.setOrigin(0,0).setScale(.7).setInteractive(),this.scene.add.existing(this)}destroy(e){this.playDestroyEffect(),super.destroy(e)}playDestroyEffect(){const{x:e,y:t}=this.getCenter();this.scene.add.particles(e,t,"particle-1",{color:[d[this.candyType]],lifespan:500,angle:{min:0,max:360},rotate:{start:h.Float(0,360),end:h.Float(0,360)},scale:{start:h.Float(.4,.5),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,stopAfter:Phaser.Math.RND.between(2,3)}),this.scene.add.particles(e,t,"particle-2",{lifespan:500,angle:{min:0,max:360},rotate:{min:0,max:360,start:h.Float(0,360),end:h.Float(0,360)},scale:{start:h.Float(1,2),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,blendMode:a.BlendModes.ADD,stopAfter:Phaser.Math.RND.between(3,5)}),this.scene.add.particles(e,t,"particle-3",{color:[d[this.candyType]],lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:0,end:1,ease:"Quart.out"},duration:300,blendMode:a.BlendModes.ADD,stopAfter:1})}}class c extends Phaser.Scene{constructor(){super("GameScene")}init(){this.canMove=!0,this.candyGridOffset=new Phaser.Math.Vector2((this.scale.width-r.gridWidth*r.tileWidth)/2,(this.scale.height-r.gridHeight*r.tileHeight)/2),this.cameras.main.setBackgroundColor(7908062),this.add.rectangle(0,0,this.scale.width,this.candyGridOffset.y,7908062).setOrigin(0).setDepth(1),this.candyGrid=[];for(let e=0;e<r.gridHeight;e++){this.candyGrid[e]=[];for(let t=0;t<r.gridWidth;t++)this.candyGrid[e][t]=this.addCandy(t,e)}this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0,this.selectedFrame=this.add.image(10,this.scale.height/2,"selected-frame").setScale(.6).setVisible(!1),this.add.tween({targets:this.selectedFrame,scale:.65,duration:600,repeat:-1,yoyo:!0}),this.input.on("gameobjectdown",this.candyDown,this),this.checkMatches()}addCandy(e,t){const s=r.candyTypes[Phaser.Math.RND.between(0,r.candyTypes.length-1)];return new o({scene:this,candyType:s,x:e*r.tileWidth+this.candyGridOffset.x,y:t*r.tileHeight+this.candyGridOffset.y,texture:s})}candyDown(e,t){if(this.canMove&&t)if(this.firstSelectedCandy){this.secondSelectedCandy=t;const e=Math.abs(this.firstSelectedCandy.x-this.secondSelectedCandy.x)/r.tileWidth,s=Math.abs(this.firstSelectedCandy.y-this.secondSelectedCandy.y)/r.tileHeight;1===e&&0===s||0===e&&1===s?(this.canMove=!1,this.swapCandies()):this.firstSelectedCandy=void 0,this.selectedFrame.setVisible(!1)}else this.selectedFrame.setVisible(!0).setPosition(t.getCenter().x,t.getCenter().y),this.firstSelectedCandy=t}swapCandies(){if(this.firstSelectedCandy&&this.secondSelectedCandy){const e=this.firstSelectedCandy.x-this.candyGridOffset.x,t=this.secondSelectedCandy.x-this.candyGridOffset.x,s=this.firstSelectedCandy.y-this.candyGridOffset.y,i=this.secondSelectedCandy.y-this.candyGridOffset.y;this.candyGrid[s/r.tileHeight][e/r.tileWidth]=this.secondSelectedCandy,this.candyGrid[i/r.tileHeight][t/r.tileWidth]=this.firstSelectedCandy;const n=this.add.particles(32,32,"particle-3",{color:[1048575],lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:1,end:0,ease:"Quart.in"},duration:300,blendMode:a.BlendModes.ADD,stopAfter:1}),d=this.add.particles(32,32,"particle-3",{color:[1048575],lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:1,end:0,ease:"Quart.in"},duration:300,blendMode:a.BlendModes.ADD,stopAfter:1});this.add.tween({targets:this.firstSelectedCandy,x:this.secondSelectedCandy.x,y:this.secondSelectedCandy.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1,onUpdate:(e,t)=>{var s,i;n.x=null!==(s=t.getCenter().x)&&void 0!==s?s:0,n.y=null!==(i=t.getCenter().y)&&void 0!==i?i:0}}),this.add.tween({targets:this.secondSelectedCandy,x:this.firstSelectedCandy.x,y:this.firstSelectedCandy.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1,onUpdate:(e,t)=>{var s,i;d.x=null!==(s=t.getCenter().x)&&void 0!==s?s:0,d.y=null!==(i=t.getCenter().y)&&void 0!==i?i:0},onComplete:()=>{this.checkMatches()}}),this.firstSelectedCandy=this.candyGrid[s/r.tileHeight][e/r.tileWidth],this.secondSelectedCandy=this.candyGrid[i/r.tileHeight][t/r.tileWidth]}}checkMatches(){const e=this.getMatches(this.candyGrid);e.length>0?(this.removeCandyGroup(e),this.resetCandy(),this.fillCandy().then((()=>{this.candyUp(),this.checkMatches()}))):(this.swapCandies(),this.candyUp(),this.canMove=!0)}resetCandy(){for(let e=this.candyGrid.length-1;e>0;e--)for(let t=this.candyGrid[e].length-1;t>=0;t--){const s=e;if(void 0===this.candyGrid[s][t]&&void 0!==this.candyGrid[s-1][t]){const i=this.candyGrid[s-1][t];this.candyGrid[s][t]=i,this.candyGrid[s-1][t]=void 0,this.add.tween({targets:i,y:r.tileHeight*s+this.candyGridOffset.y,ease:"Bounce.out",duration:500}),t=this.candyGrid[s].length,e=this.candyGrid.length-1}}}fillCandy(){return new Promise((e=>{const t=[];for(let e=0;e<r.gridHeight;e++)t[e]=[];for(let e=0;e<this.candyGrid.length;e++)for(let s=0;s<this.candyGrid[e].length;s++)if(void 0===this.candyGrid[e][s]){const i=this.addCandy(s,e);t[s].push(i),this.candyGrid[e][s]=i}for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){const i=t[e][s];i.y-=r.tileHeight*t[e].length,this.add.tween({targets:i,y:i.y+r.tileHeight*t[e].length,ease:"Bounce.out",duration:500})}this.tweens.addCounter({duration:500,onComplete:()=>{e()}})}))}candyUp(){this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0}removeCandyGroup(e){const t=e.flat();for(const e of t){const t=this.getTilePos(this.candyGrid,e);-1!==t.x&&-1!==t.y&&(e.destroy(),this.candyGrid[t.y][t.x]=void 0)}}getTilePos(e,t){const s=new Phaser.Math.Vector2(-1,-1);for(let i=0;i<e.length;i++)for(let a=0;a<e[i].length;a++)if(t===e[i][a]){s.x=a,s.y=i;break}return s}getMatches(e){const t=[],s=[];for(let t=0;t<e.length;t++){s[t]=[];for(let i=0;i<e[t].length;i++)s[t][i]=!1}for(let i=0;i<e.length;i++)for(let a=0;a<e[i].length-2;a++){const n=e[i][a];if(n&&!s[i][a]){const d=[n];let r=1;for(let t=a+1;t<e[i].length;t++){const s=e[i][t];if(!s||s.candyType!==n.candyType)break;d.push(s),r++}r>=3&&(t.push(d),d.forEach((e=>{const t=e.y,i=e.x;s[t]&&!1===s[t][i]&&(s[t][i]=!0)})))}}for(let i=0;i<e[0].length;i++)for(let a=0;a<e.length-2;a++){const n=e[a][i];if(n&&!s[a][i]){const d=[n];let r=1;for(let t=a+1;t<e.length;t++){const s=e[t][i];if(!s||s.candyType!==n.candyType)break;d.push(s),r++}r>=3&&(t.push(d),d.forEach((e=>{const t=e.y,i=e.x;s[t]&&!1===s[t][i]&&(s[t][i]=!0)})))}}return t}}const l={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",scale:{width:520,height:window.innerHeight>window.innerWidth?520*window.innerHeight/window.innerWidth:700,parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},type:Phaser.WEBGL,parent:"game",scene:[n,c],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class y extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new y(l)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,a,n)=>{if(!s){var d=1/0;for(c=0;c<e.length;c++){for(var[s,a,n]=e[c],r=!0,h=0;h<s.length;h++)(!1&n||d>=n)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(r=!1,n<d&&(d=n));if(r){e.splice(c--,1);var o=a();void 0!==o&&(t=o)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,a,n]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[d,r,h]=s,o=0;if(d.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(h)var c=h(i)}for(t&&t(s);o<d.length;o++)n=d[o],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(c)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[216],(()=>i(992)));a=i.O(a)})();