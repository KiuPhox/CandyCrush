(()=>{"use strict";var e,t={992:(e,t,i)=>{var s,a=i(260);class n extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}!function(e){e.BLUE="blue",e.GREEN="green",e.ORANGE="orange",e.PURPLE="purple",e.RED="red",e.YELLOW="yellow"}(s||(s={}));const d={blue:430079,green:1507072,orange:16736256,purple:14506198,red:16646144,yellow:16776960},r={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:64,candyTypes:[s.BLUE,s.GREEN,s.ORANGE,s.PURPLE,s.RED,s.YELLOW]};class h extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.candyType=e.candyType,this.setOrigin(0,0).setScale(.7).setInteractive(),this.scene.add.existing(this)}}class c{static Float(e,t){return Math.random()*(t-e)+e}static Int(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static Percent(e){return this.Float(0,100)<=e}}class o extends Phaser.Scene{constructor(){super("GameScene")}init(){this.canMove=!0,this.candyGridOffset=new Phaser.Math.Vector2((this.scale.width-r.gridWidth*r.tileWidth)/2,(this.scale.height-r.gridHeight*r.tileHeight)/2),this.cameras.main.setBackgroundColor(7908062),this.add.rectangle(0,0,this.scale.width,this.candyGridOffset.y,7908062).setOrigin(0).setDepth(1),this.candyGrid=[];for(let e=0;e<r.gridHeight;e++){this.candyGrid[e]=[];for(let t=0;t<r.gridWidth;t++)this.candyGrid[e][t]=this.addCandy(t,e)}this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0,this.input.on("gameobjectdown",this.candyDown,this),this.checkMatches()}addCandy(e,t){const i=r.candyTypes[Phaser.Math.RND.between(0,r.candyTypes.length-1)];return new h({scene:this,candyType:i,x:e*r.tileWidth+this.candyGridOffset.x,y:t*r.tileHeight+this.candyGridOffset.y,texture:i})}candyDown(e,t){if(this.canMove&&t)if(this.firstSelectedCandy){this.secondSelectedCandy=t;const e=Math.abs(this.firstSelectedCandy.x-this.secondSelectedCandy.x)/r.tileWidth,i=Math.abs(this.firstSelectedCandy.y-this.secondSelectedCandy.y)/r.tileHeight;(1===e&&0===i||0===e&&1===i)&&(this.canMove=!1,this.swapCandies())}else this.firstSelectedCandy=t}swapCandies(){if(this.firstSelectedCandy&&this.secondSelectedCandy){const e=this.firstSelectedCandy.x-this.candyGridOffset.x,t=this.secondSelectedCandy.x-this.candyGridOffset.x,i=this.firstSelectedCandy.y-this.candyGridOffset.y,s=this.secondSelectedCandy.y-this.candyGridOffset.y;this.candyGrid[i/r.tileHeight][e/r.tileWidth]=this.secondSelectedCandy,this.candyGrid[s/r.tileHeight][t/r.tileWidth]=this.firstSelectedCandy,this.add.tween({targets:this.firstSelectedCandy,x:this.secondSelectedCandy.x,y:this.secondSelectedCandy.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1}),this.add.tween({targets:this.secondSelectedCandy,x:this.firstSelectedCandy.x,y:this.firstSelectedCandy.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches()}}),this.firstSelectedCandy=this.candyGrid[i/r.tileHeight][e/r.tileWidth],this.secondSelectedCandy=this.candyGrid[s/r.tileHeight][t/r.tileWidth]}}checkMatches(){const e=this.getMatches(this.candyGrid);e.length>0?(this.removeCandyGroup(e),this.resetCandy(),this.fillCandy().then((()=>{this.candyUp(),this.checkMatches()}))):(this.swapCandies(),this.candyUp(),this.canMove=!0)}resetCandy(){for(let e=this.candyGrid.length-1;e>0;e--)for(let t=this.candyGrid[e].length-1;t>=0;t--){const i=e;if(void 0===this.candyGrid[i][t]&&void 0!==this.candyGrid[i-1][t]){const s=this.candyGrid[i-1][t];this.candyGrid[i][t]=s,this.candyGrid[i-1][t]=void 0,this.add.tween({targets:s,y:r.tileHeight*i+this.candyGridOffset.y,ease:"Bounce.out",duration:500}),t=this.candyGrid[i].length,e=this.candyGrid.length-1}}}fillCandy(){return new Promise((e=>{const t=[];for(let e=0;e<r.gridHeight;e++)t[e]=[];for(let e=0;e<this.candyGrid.length;e++)for(let i=0;i<this.candyGrid[e].length;i++)if(void 0===this.candyGrid[e][i]){const s=this.addCandy(i,e);t[i].push(s),this.candyGrid[e][i]=s}for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++){const s=t[e][i];s.y-=r.tileHeight*t[e].length,this.add.tween({targets:s,y:s.y+r.tileHeight*t[e].length,ease:"Bounce.out",duration:500})}this.tweens.addCounter({duration:500,onComplete:()=>{e()}})}))}candyUp(){this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0}removeCandyGroup(e){const t=e.flat();for(const e of t){const t=this.getTilePos(this.candyGrid,e);if(-1!==t.x&&-1!==t.y){e.destroy(),this.candyGrid[t.y][t.x]=void 0;const{x:i,y:s}=e.getCenter();this.add.particles(i,s,"particle-1",{color:[d[e.candyType]],lifespan:500,angle:{min:0,max:360},rotate:{start:c.Float(0,360),end:c.Float(0,360)},scale:{start:c.Float(.4,.5),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,stopAfter:Phaser.Math.RND.between(2,3)}),this.add.particles(i,s,"particle-2",{lifespan:500,angle:{min:0,max:360},rotate:{min:0,max:360,start:c.Float(0,360),end:c.Float(0,360)},scale:{start:c.Float(1,2),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,blendMode:a.BlendModes.ADD,stopAfter:Phaser.Math.RND.between(3,5)}),this.add.particles(i,s,"particle-3",{color:[d[e.candyType]],lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:0,end:1,ease:"Quart.out"},duration:300,blendMode:a.BlendModes.ADD,stopAfter:1})}}}getTilePos(e,t){const i=new Phaser.Math.Vector2(-1,-1);for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(t===e[s][a]){i.x=a,i.y=s;break}return i}getMatches(e){const t=[],i=[];for(let t=0;t<e.length;t++){i[t]=[];for(let s=0;s<e[t].length;s++)i[t][s]=!1}for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length-2;a++){const n=e[s][a];if(n&&!i[s][a]){const d=[n];let r=1;for(let t=a+1;t<e[s].length;t++){const i=e[s][t];if(!i||i.candyType!==n.candyType)break;d.push(i),r++}r>=3&&(t.push(d),d.forEach((e=>{const t=e.y,s=e.x;i[t]&&!1===i[t][s]&&(i[t][s]=!0)})))}}for(let s=0;s<e[0].length;s++)for(let a=0;a<e.length-2;a++){const n=e[a][s];if(n&&!i[a][s]){const d=[n];let r=1;for(let t=a+1;t<e.length;t++){const i=e[t][s];if(!i||i.candyType!==n.candyType)break;d.push(i),r++}r>=3&&(t.push(d),d.forEach((e=>{const t=e.y,s=e.x;i[t]&&!1===i[t][s]&&(i[t][s]=!0)})))}}return t}}const l={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",scale:{width:520,height:window.innerHeight>window.innerWidth?520*window.innerHeight/window.innerWidth:700,parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},type:Phaser.WEBGL,parent:"game",scene:[n,o],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class y extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new y(l)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={exports:{}};return t[e].call(n.exports,n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,i,a,n)=>{if(!i){var d=1/0;for(o=0;o<e.length;o++){for(var[i,a,n]=e[o],r=!0,h=0;h<i.length;h++)(!1&n||d>=n)&&Object.keys(s.O).every((e=>s.O[e](i[h])))?i.splice(h--,1):(r=!1,n<d&&(d=n));if(r){e.splice(o--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var o=e.length;o>0&&e[o-1][2]>n;o--)e[o]=e[o-1];e[o]=[i,a,n]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[d,r,h]=i,c=0;if(d.some((t=>0!==e[t]))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(h)var o=h(s)}for(t&&t(i);c<d.length;c++)n=d[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(o)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(992)));a=s.O(a)})();