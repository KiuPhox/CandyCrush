(()=>{"use strict";var e,t={893:(e,t,s)=>{var i,r,a,n=s(260);class d extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}!function(e){e.CREATE="create",e.IDLE="idle",e.SWAP="swap",e.MATCH="match",e.NO_MOVE="no-move"}(i||(i={})),function(e){e.BLUE="blue",e.GREEN="green",e.ORANGE="orange",e.PURPLE="purple",e.RED="red",e.YELLOW="yellow"}(r||(r={})),function(e){e.NONE="none",e.VERTICAL_STRIPED="vertical-striped",e.HORIZONTAL_STRIPED="horizontal-striped",e.WRAPPED="wrapped",e.COLOR_BOMB="color-bomb"}(a||(a={}));const c={blue:430079,green:1507072,orange:16736256,purple:14506198,red:16646144,yellow:16776960},h={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:64,candyTypes:[r.BLUE,r.GREEN,r.ORANGE]};class o{constructor(e,t){this.name=e,this.currentState=t,this.previousState=t,this.emitter=new Phaser.Events.EventEmitter}static getInstance(){return this.instance||(this.instance=new this),this.instance}updateState(e){this.currentState!==e&&(this.previousState=this.currentState,this.currentState=e,this.handleStateChange(),this.emitter.emit(this.name+"state-changed",this.currentState,this.previousState))}getCurrentState(){return this.currentState}getPreviousState(){return this.previousState}}class l extends o{constructor(){super("board",i.IDLE)}handleStateChange(){}}class g{static Float(e,t){return Math.random()*(t-e)+e}static Int(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static Percent(e){return this.Float(0,100)<=e}static shuffleArray(e){const t=[...e];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}}const p=[{texture:"particle-1",config:{lifespan:500,angle:{min:0,max:360},rotate:{start:g.Float(0,360),end:g.Float(0,360)},scale:{start:g.Float(.4,.5),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,stopAfter:g.Int(2,3)}},{texture:"particle-2",config:{lifespan:500,angle:{min:0,max:360},rotate:{min:0,max:360,start:g.Float(0,360),end:g.Float(0,360)},scale:{start:g.Float(1,2),end:0,ease:"Back.in"},speed:{min:100,max:120},gravityY:200,duration:300,blendMode:n.BlendModes.ADD,stopAfter:g.Int(3,5)}},{texture:"particle-3",config:{lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:0,end:1,ease:"Quart.out"},duration:300,blendMode:n.BlendModes.ADD,stopAfter:1}}];class y{static init(e){this.scene=e,this.particleEmitters=new Map,p.forEach((e=>{this.particleEmitters.set(e.texture,this.scene.add.particles(void 0,void 0,e.texture,e.config))}))}static playCandyExplodeEffect(e,t,s){const i=this.particleEmitters.get("particle-1"),r=this.particleEmitters.get("particle-2"),a=this.particleEmitters.get("particle-3");i&&r&&a&&(i.particleTint=s,a.particleTint=s,i.emitParticleAt(e,t),r.emitParticleAt(e,t),a.emitParticleAt(e,t))}}class u extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.candyType,e.frame),this.gridX=e.gridX,this.gridY=e.gridY,this.candyType=e.candyType,this.setSpecialType(e.specialType),this.setScale(.7).setInteractive(),this.scene.add.existing(this)}playExplodeEffect(){var e,t;const s=null!==(e=this.getCenter().x)&&void 0!==e?e:0,i=null!==(t=this.getCenter().y)&&void 0!==t?t:0;y.playCandyExplodeEffect(s,i,c[this.candyType])}setGrid(e,t){this.gridX=e,this.gridY=t}getSpecialType(){return this.specialType}setSpecialType(e){switch(this.specialType=e,e){case a.NONE:this.setTexture(this.candyType);break;case a.VERTICAL_STRIPED:case a.HORIZONTAL_STRIPED:this.setTexture(`${this.candyType}-${this.specialType}`);break;case a.COLOR_BOMB:this.setTexture("")}}getCandyType(){return this.candyType}setCandyType(e){this.candyType=e}destroy(e){this.playExplodeEffect(),super.destroy(e)}}class f{static init(e){this.scene=e,this.grid=[],this.swapEffects=[],this.candyGridOffset=new Phaser.Math.Vector2((e.scale.width-h.gridWidth*h.tileWidth+h.tileWidth)/2,(e.scale.height-h.gridHeight*h.tileHeight+h.tileWidth)/2)}static create(){l.getInstance().updateState(i.CREATE);let e=[];for(let t=0;t<h.gridHeight;t++){this.grid[t]=[];for(let s=0;s<h.gridWidth;s++){const i=this.addCandy(s,t);this.grid[t][s]=i,e.push(i)}}e=g.shuffleArray(e);const t=500/e.length;this.scene.tweens.addCounter({from:260,to:40,duration:1e3,ease:"Sine.easeInOut",repeat:1,yoyo:!0,onUpdate:t=>{Phaser.Actions.RotateAroundDistance(e,{x:this.scene.scale.width/2,y:this.scene.scale.height/2},.03,t.getValue())},onComplete:()=>{e.forEach(((e,s)=>{this.scene.add.tween({targets:e,x:e.gridX*h.tileWidth+this.candyGridOffset.x,y:e.gridY*h.tileHeight+this.candyGridOffset.y,duration:500,ease:"Quad.out",delay:s*t})}))}});const s=4e3+e.length*t+500;return this.scene.time.delayedCall(s,(()=>{this.scene.checkMatches()})),this.grid}static clear(){for(let e=0;e<h.gridHeight;e++)for(let t=0;t<h.gridWidth;t++){const s=this.grid[e][t];s&&(s.destroy(),this.grid[e][t]=void 0)}}static playIdleEffect(){for(let e=0;e<this.grid.length;e++)for(let t=0;t<this.grid[e].length;t++){const s=this.grid[e][t];s&&this.scene.add.tween({targets:s,y:s.y-20,duration:200,delay:100*(e+t),ease:"Quad.out",yoyo:!0})}}static addCandy(e,t,s,i){const r=null!=s?s:h.candyTypes[Phaser.Math.RND.between(0,h.candyTypes.length-1)],n=null!=i?i:a.NONE;return new u({scene:this.scene,candyType:r,specialType:n,x:e*h.tileWidth+this.candyGridOffset.x,y:t*h.tileHeight+this.candyGridOffset.y,gridX:e,gridY:t})}static fillCandy(){return new Promise((e=>{const t=[];for(let e=0;e<h.gridHeight;e++)t[e]=[];for(let e=0;e<this.grid.length;e++)for(let s=0;s<this.grid[e].length;s++)if(void 0===this.grid[e][s]){const i=this.addCandy(s,e);t[s].push(i),this.grid[e][s]=i}for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){const i=t[e][s];i.y-=h.tileHeight*t[e].length,this.scene.add.tween({targets:i,y:i.y+h.tileHeight*t[e].length,ease:"Bounce.out",duration:500})}this.scene.tweens.addCounter({duration:500,onComplete:()=>{e()}})}))}static resetCandy(){var e;for(let t=this.grid.length-1;t>0;t--)for(let s=this.grid[t].length-1;s>=0;s--){const i=t;if(void 0===this.grid[i][s]&&void 0!==this.grid[i-1][s]){const r=this.grid[i-1][s];this.grid[i][s]=r,this.grid[i-1][s]=void 0,null==r||r.setGrid(s,i),null===(e=this.grid[i-1][s])||void 0===e||e.setGrid(s,i-1),this.scene.add.tween({targets:r,y:h.tileHeight*i+f.candyGridOffset.y,ease:"Bounce.out",duration:500}),s=this.grid[i].length,t=this.grid.length-1}}}static swapCandies(e,t){if(e&&t){l.getInstance().updateState(i.SWAP);const s=e.gridX,r=e.gridY,a=t.gridX,d=t.gridY;this.grid[r][s]=t,this.grid[d][a]=e,t.setGrid(s,r),e.setGrid(a,d),this.swapEffects.forEach((e=>e.destroy()));const c=this.scene.add.particles(32,32,"particle-3",{lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:1,end:0,ease:"Quart.in"},duration:300,blendMode:n.BlendModes.ADD,stopAfter:1}),h=this.scene.add.particles(32,32,"particle-3",{lifespan:500,alpha:{start:1,end:0,ease:"Quad.out"},scale:{start:1,end:0,ease:"Quart.in"},duration:300,blendMode:n.BlendModes.ADD,stopAfter:1});this.swapEffects.push(c,h),this.scene.add.tween({targets:e,x:t.x,y:t.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1,onUpdate:(e,t)=>{var s,i;c.x=null!==(s=t.getCenter().x)&&void 0!==s?s:0,c.y=null!==(i=t.getCenter().y)&&void 0!==i?i:0}}),this.scene.add.tween({targets:t,x:e.x,y:e.y,ease:"Quad.out",duration:200,repeat:0,yoyo:!1,onUpdate:(e,t)=>{var s,i;h.x=null!==(s=t.getCenter().x)&&void 0!==s?s:0,h.y=null!==(i=t.getCenter().y)&&void 0!==i?i:0},onComplete:()=>{this.scene.checkMatches()}})}}static removeCandyGroup(e){let t=[];const s=[];for(const i of e)if(t=t.concat(i.candies),4===i.candies.length){const e=this.addCandy(i.candies[0].gridX,i.candies[0].gridY,i.candies[0].getCandyType(),"horizontal"===i.direction?a.VERTICAL_STRIPED:a.HORIZONTAL_STRIPED);s.push(e)}const i=new Set(t);for(const e of i)if(e.getSpecialType()===a.HORIZONTAL_STRIPED)for(const t of this.grid[e.gridY])t&&i.add(t);else if(e.getSpecialType()===a.VERTICAL_STRIPED)for(let t=0;t<this.grid[e.gridY].length;t++){const s=this.grid[t][e.gridX];s&&i.add(s)}for(const e of i)this.grid[e.gridY][e.gridX]&&(e.destroy(),this.grid[e.gridY][e.gridX]=void 0);for(const e of s)this.grid[e.gridY][e.gridX]=e}static getHints(){const e=(e,t)=>{if(e&&t){const s=this.grid[e.x][e.y],i=this.grid[t.x][t.y],r=s;this.grid[e.x][e.y]=i,this.grid[t.x][t.y]=r}};for(let t=0;t<this.grid.length;t++)for(let s=0;s<this.grid[t].length-1;s++){const i=new Phaser.Math.Vector2(t,s),r=new Phaser.Math.Vector2(t,s+1);e(i,r);const a=this.getMatches();if(a.length>0)return e(i,r),a;e(i,r)}for(let t=0;t<this.grid[0].length;t++)for(let s=0;s<this.grid.length-1;s++){const i=new Phaser.Math.Vector2(s,t),r=new Phaser.Math.Vector2(s+1,t);e(i,r);const a=this.getMatches();if(a.length>0)return e(i,r),a;e(i,r)}return[]}static getMatches(){const e=[],t=[];for(let e=0;e<this.grid.length;e++){t[e]=[];for(let s=0;s<this.grid[e].length;s++)t[e][s]=!1}for(let s=0;s<this.grid.length;s++)for(let i=0;i<this.grid[s].length-2;i++){const r=this.grid[s][i];if(r&&!t[s][i]){const a={candies:[r],direction:"horizontal"};let n=1;for(let e=i+1;e<this.grid[s].length;e++){const t=this.grid[s][e];if(!t||t.getCandyType()!==r.getCandyType())break;a.candies.push(t),n++}n>=3&&(e.push(a),a.candies.forEach((e=>{const s=e.gridY,i=e.gridX;t[s]&&!1===t[s][i]&&(t[s][i]=!0)})))}}for(let e=0;e<this.grid.length;e++)for(let s=0;s<this.grid[e].length;s++)t[e][s]=!1;for(let s=0;s<this.grid[0].length;s++)for(let i=0;i<this.grid.length-2;i++){const r=this.grid[i][s];if(r&&!t[i][s]){const a={candies:[r],direction:"vertical"};let n=1;for(let e=i+1;e<this.grid.length;e++){const t=this.grid[e][s];if(!t||t.getCandyType()!==r.getCandyType())break;a.candies.push(t),n++}n>=3&&(e.push(a),a.candies.forEach((e=>{const s=e.gridY,i=e.gridX;t[s]&&!1===t[s][i]&&(t[s][i]=!0)})))}}return e}}var m;class C{static init(e){this.scene=e,this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0,this.selectedFrame=e.add.image(0,0,"selected-frame").setScale(.6).setVisible(!1),e.add.tween({targets:this.selectedFrame,scale:.65,duration:600,repeat:-1,yoyo:!0}),e.input.on("gameobjectdown",this.candyDown,e)}static setFramePosition(e){this.selectedFrame.setPosition(e.getCenter().x,e.getCenter().y).setVisible(!0)}static candyUp(){this.firstSelectedCandy=void 0,this.secondSelectedCandy=void 0}}m=C,C.candyDown=(e,t)=>{if(l.getInstance().getCurrentState()===i.IDLE&&t)if(m.firstSelectedCandy)if(m.firstSelectedCandy===t)m.firstSelectedCandy=void 0,m.selectedFrame.setVisible(!1);else{m.secondSelectedCandy=t;const e=Math.abs(m.firstSelectedCandy.gridX-m.secondSelectedCandy.gridX),s=Math.abs(m.firstSelectedCandy.gridY-m.secondSelectedCandy.gridY);1===e&&0===s||0===e&&1===s?(l.getInstance().updateState(i.SWAP),f.swapCandies(m.firstSelectedCandy,m.secondSelectedCandy)):m.firstSelectedCandy=void 0,m.selectedFrame.setVisible(!1)}else m.firstSelectedCandy=t,m.setFramePosition(m.firstSelectedCandy)};class S extends Phaser.GameObjects.Container{constructor(e){super(e),e.add.existing(this),this.createProgressbar()}createProgressbar(){this.currentProgress=1,this.add(this.scene.add.image(-350,0,"progress-head")),this.progressFill=this.scene.add.image(-350,0,"progress-fill").setOrigin(0,.5).setScale(this.currentProgress,1),this.add(this.progressFill)}getProgress(){return this.currentProgress}updateProgress(e){e<=50&&(this.currentProgress=e,this.scene.add.tween({targets:this.progressFill,scaleX:e,duration:200,ease:"Quad.out"}))}}class E extends Phaser.Scene{constructor(){super("GameScene")}init(){y.init(this),f.init(this),C.init(this),this.createRectangleMask(),this.progressBar=new S(this).setDepth(2).setScale(.5).setPosition(this.rectangleMask.getCenter().x,this.rectangleMask.getCenter().y),this.cameras.main.setBackgroundColor(7908062),f.create(),this.tryGetHint(),this.idleTimer=5e3}createRectangleMask(){this.rectangleMask=this.add.rectangle(0,0,this.scale.width,f.candyGridOffset.y-h.tileWidth/2,7908062).setOrigin(0).setDepth(1)}checkMatches(){this.hintTween&&!this.hintTween.isDestroyed()&&l.getInstance().getCurrentState()!==i.SWAP&&(this.hintTween.stop(),this.hintTween.destroy());const e=f.getMatches();e.length>0?(this.progressBar.updateProgress(this.progressBar.getProgress()+1),l.getInstance().updateState(i.MATCH),f.removeCandyGroup(e),f.resetCandy(),f.fillCandy().then((()=>{C.candyUp(),this.checkMatches()}))):(l.getInstance().getCurrentState()===i.MATCH&&this.tryGetHint(),f.swapCandies(C.firstSelectedCandy,C.secondSelectedCandy),C.candyUp(),this.tweens.addCounter({duration:200,onComplete:()=>{l.getInstance().updateState(i.IDLE)}}))}tryGetHint(){const e=f.getHints()[0],t=[];e?(e.candies.forEach((e=>t.push(e.y))),this.hintTween=this.tweens.addCounter({duration:300,repeat:-1,from:0,to:1,yoyo:!0,onUpdate:t=>{e.candies.forEach(((e,s)=>{const i=Phaser.Math.Easing.Bounce.InOut(t.getValue());e.setScale(.7+i*(.7-.75),.7+i*(.7-.65))}))},onStop:()=>{e.candies.forEach((e=>{e.setScale(.7)}))}})):(f.clear(),f.create(),this.checkMatches(),this.tryGetHint())}update(e,t){l.getInstance().getCurrentState()===i.IDLE?(this.idleTimer-=t,this.idleTimer<=0&&(this.idleTimer=3e3,f.playIdleEffect())):this.idleTimer=5e3}}const T={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",scale:{width:520,height:window.innerHeight>window.innerWidth?520*window.innerHeight/window.innerWidth:700,parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},type:Phaser.WEBGL,parent:"game",scene:[d,E],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class w extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new w(T)}))}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,r,a)=>{if(!s){var n=1/0;for(o=0;o<e.length;o++){for(var[s,r,a]=e[o],d=!0,c=0;c<s.length;c++)(!1&a||n>=a)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(d=!1,a<n&&(n=a));if(d){e.splice(o--,1);var h=r();void 0!==h&&(t=h)}}return t}a=a||0;for(var o=e.length;o>0&&e[o-1][2]>a;o--)e[o]=e[o-1];e[o]=[s,r,a]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,a,[n,d,c]=s,h=0;if(n.some((t=>0!==e[t]))){for(r in d)i.o(d,r)&&(i.m[r]=d[r]);if(c)var o=c(i)}for(t&&t(s);h<n.length;h++)a=n[h],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(o)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=i.O(void 0,[216],(()=>i(893)));r=i.O(r)})();